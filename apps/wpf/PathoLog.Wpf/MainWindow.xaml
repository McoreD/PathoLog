<Window x:Class="PathoLog.Wpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="PathoLog" Height="900" Width="1400">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="260" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" Background="#1E2A38" Padding="16">
            <DockPanel>
                <StackPanel DockPanel.Dock="Top">
                    <TextBlock Text="PathoLog" FontSize="20" FontWeight="Bold" Foreground="White" />
                    <TextBlock Text="Patients" Margin="0,16,0,8" Foreground="#B9C6D3" />
                </StackPanel>

                <ListBox ItemsSource="{Binding Patients}"
                         SelectedItem="{Binding SelectedPatient}"
                         DisplayMemberPath="DisplayName"
                         Background="#14202B"
                         Foreground="White"
                         BorderThickness="0"
                         Margin="0,0,0,12" />

                <StackPanel DockPanel.Dock="Bottom">
                    <Button Content="New Patient" Margin="0,0,0,8" Command="{Binding NewPatientCommand}" />
                    <Button Content="Import PDF" Command="{Binding SelectPdfCommand}" />
                </StackPanel>
            </DockPanel>
        </Border>

        <TabControl Grid.Column="1" Margin="12">
            <TabItem Header="Dashboard">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <TextBlock Text="Patient:" FontWeight="Bold" Margin="0,0,8,0" />
                        <TextBlock Text="{Binding SelectedPatient.DisplayName}" />
                    </StackPanel>

                    <UniformGrid Grid.Row="1" Columns="3" Margin="0,16,0,0">
                        <Border Background="#F1F5F9" CornerRadius="8" Padding="12" Margin="0,0,12,0">
                            <StackPanel>
                                <TextBlock Text="Recent Reports" Foreground="#64748B" />
                                <TextBlock Text="{Binding RecentReportsCount}" FontSize="24" FontWeight="Bold" />
                            </StackPanel>
                        </Border>
                        <Border Background="#F1F5F9" CornerRadius="8" Padding="12" Margin="0,0,12,0">
                            <StackPanel>
                                <TextBlock Text="Pending Reviews" Foreground="#64748B" />
                                <TextBlock Text="{Binding PendingReviewsCount}" FontSize="24" FontWeight="Bold" />
                            </StackPanel>
                        </Border>
                        <Border Background="#F1F5F9" CornerRadius="8" Padding="12">
                            <StackPanel>
                                <TextBlock Text="Mappings" Foreground="#64748B" />
                                <TextBlock Text="{Binding MappingCount}" FontSize="24" FontWeight="Bold" />
                            </StackPanel>
                        </Border>
                    </UniformGrid>
                </Grid>
            </TabItem>

            <TabItem Header="Import">
                <Grid Margin="16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="220" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <StackPanel>
                        <TextBlock Text="Import Steps" FontWeight="Bold" Margin="0,0,0,12" />
                        <ListBox>
                            <ListBoxItem Content="1. Select PDF" />
                            <ListBoxItem Content="2. Extract text" />
                            <ListBoxItem Content="3. AI structuring" />
                            <ListBoxItem Content="4. Review low confidence" />
                            <ListBoxItem Content="5. Save report" />
                        </ListBox>
                        <Separator Margin="0,8,0,8"/>
                        <TextBlock Text="Load parsed JSON" FontWeight="Bold" Margin="0,0,0,6" />
                        <Button Content="Load report JSON" Command="{Binding LoadReportJsonCommand}" />
                    </StackPanel>

                    <StackPanel Grid.Column="1" Margin="16,0,0,0">
                        <TextBlock Text="Selected file" FontWeight="Bold" />
                        <TextBlock Text="{Binding SelectedFileName}" Margin="0,4,0,16" />
                        <StackPanel Orientation="Horizontal">
                            <Button Content="Choose PDF" Width="120" Command="{Binding SelectPdfCommand}" />
                            <Button Content="Start Import" Width="120" Margin="12,0,0,0" Command="{Binding ImportPdfCommand}" />
                        </StackPanel>
                        <TextBlock Text="{Binding ImportStatus}" Margin="0,16,0,0" Foreground="#1F2937" />
                    </StackPanel>
                </Grid>
            </TabItem>

            <TabItem Header="Reports">
                <Grid Margin="16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="260" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <StackPanel>
                        <TextBlock Text="Reports" FontWeight="Bold" Margin="0,0,0,8" />
                        <ListBox ItemsSource="{Binding Reports}"
                                 SelectedItem="{Binding SelectedReport}"
                                 DisplayMemberPath="PanelName"
                                 Height="420" />
                    </StackPanel>

                    <Grid Grid.Column="1" Margin="16,0,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                            <TextBlock Text="Report:" FontWeight="Bold" Margin="0,0,8,0" />
                            <TextBlock Text="{Binding SelectedReport.ReportDate}" Margin="0,0,12,0" />
                            <TextBlock Text="{Binding SelectedReport.PanelName}" />
                        </StackPanel>

                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Border Margin="0,0,8,0" BorderBrush="#CBD5E1" BorderThickness="1" CornerRadius="6">
                                <StackPanel Margin="8">
                                    <TextBlock Text="PDF Viewer" FontWeight="Bold" Margin="0,0,0,8" />
                                    <Border Background="#F8FAFC" Height="320">
                                        <TextBlock Text="PDF preview" VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="#94A3B8" />
                                    </Border>
                                </StackPanel>
                            </Border>
                            <Border Grid.Column="1" BorderBrush="#CBD5E1" BorderThickness="1" CornerRadius="6">
                                <StackPanel Margin="8">
                                    <TextBlock Text="Structured Results" FontWeight="Bold" Margin="0,0,0,8" />
                                    <DataGrid ItemsSource="{Binding Results}" AutoGenerateColumns="False" Height="320">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Analyte" Binding="{Binding Analyte}" />
                                            <DataGridTextColumn Header="Value" Binding="{Binding Value}" />
                                            <DataGridTextColumn Header="Unit" Binding="{Binding Unit}" />
                                            <DataGridTextColumn Header="Flag" Binding="{Binding Flag}" />
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>
                        </Grid>

                        <Grid Grid.Row="2" Margin="0,12,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <GroupBox Header="Compare Last vs Baseline" Margin="0,0,12,0">
                                <TextBlock Text="Comparison view placeholder" Margin="8" />
                            </GroupBox>
                            <GroupBox Header="Reference Range">
                                <TextBlock Text="Range overlay placeholder" Margin="8" />
                            </GroupBox>
                        </Grid>
                    </Grid>
                </Grid>
            </TabItem>

            <TabItem Header="Review Queue">
                <Grid Margin="16">
                    <DataGrid ItemsSource="{Binding ReviewTasks}" AutoGenerateColumns="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Field" Binding="{Binding FieldPath}" Width="*" />
                            <DataGridTextColumn Header="Reason" Binding="{Binding Reason}" Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <TabItem Header="Mappings">
                <Grid Margin="16">
                    <DataGrid ItemsSource="{Binding Mappings}" AutoGenerateColumns="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Source Name" Binding="{Binding SourceName}" Width="*" />
                            <DataGridTextColumn Header="Short Code" Binding="{Binding ShortCode}" Width="120" />
                            <DataGridTextColumn Header="Method" Binding="{Binding Method}" Width="140" />
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <TabItem Header="Trends">
                <ScrollViewer Margin="16">
                    <ItemsControl ItemsSource="{Binding Trends}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="#CBD5E1" BorderThickness="1" CornerRadius="8" Margin="0,0,0,16" Padding="12">
                                    <StackPanel>
                                        <TextBlock Text="{Binding AnalyteShortCode}" FontWeight="Bold" Margin="0,0,0,8" />
                                        <Canvas Height="140" Background="#F8FAFC">
                                            <Polyline Points="{Binding Points}" Stroke="#2563EB" StrokeThickness="2" />
                                        </Canvas>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Export">
                <StackPanel Margin="16">
                    <TextBlock Text="Export data" FontWeight="Bold" Margin="0,0,0,8" />
                    <Button Content="Export CSV" Width="120" Command="{Binding ExportCsvCommand}" />
                </StackPanel>
            </TabItem>

            <TabItem Header="Settings">
                <StackPanel Margin="16" Width="420">
                    <TextBlock Text="API Keys" FontWeight="Bold" FontSize="14" Margin="0,0,0,12" />
                    <TextBlock Text="{Binding ModelInfo}" Foreground="#64748B" Margin="0,0,0,12"/>
                    <TextBlock Text="Preferred AI Provider" />
                    <ComboBox Margin="0,4,0,12"
                              ItemsSource="{Binding AiProviders}"
                              DisplayMemberPath="Label"
                              SelectedValuePath="Id"
                              SelectedValue="{Binding SelectedAiProviderId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    <TextBlock Text="OpenAI API Key" />
                    <TextBox Margin="0,4,0,12"
                             Text="{Binding OpenAiApiKey, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             FontFamily="Consolas"
                             />
                    <TextBlock Text="Gemini API Key" />
                    <TextBox Margin="0,4,0,12"
                             Text="{Binding GeminiApiKey, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             FontFamily="Consolas"
                             />
                    <TextBlock Text="Keys are stored locally on this device only." Foreground="#64748B" Margin="0,0,0,12" />
                    <Button Content="Save settings" Width="140" Command="{Binding SaveSettingsCommand}" />
                </StackPanel>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
